# Transaction module
stayNULS2.0In the ecosystem, transactions will flow within or between chains, and nodes in each chain not only need to handle transactions within the chain, but may also handle transactions across chains. Therefore, each node needs to handle more and more complex transactions, so we need a separate module to handle various transactions uniformly. And fromNULS2.0From the perspective of architecture design, we need an independent module to handle transaction collection、validate、Provide secure transaction data for block assembly、Storage and other functions are shared for all transactions、Uniformity, therefore we operate transaction management as an independent module.

## Process local transactions

- Collect transactions
- Local verification
- Broadcast forwarding transactions to other nodes
- Extract packable transactions
- Submit、Rollback transaction
- Save unconfirmed、Packable and confirmed transactions
- Provide transaction data

## Interface List
### tx\_register
Registration module transaction/Register module transactions
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name                                                             |       Parameter type       | Parameter Description        | Is it not empty |
| --------------------------------------------------------------- |:----------------:| ----------- |:----:|
| chainId                                                         |       int        | chainid         |  yes   |
| moduleCode                                                      |      string      | Module for registering transactionscode |  yes   |
| list                                                            |       list       | Data to be registered for transactions    |  yes   |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;txType          |       int        | Transaction type        |  yes   |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;systemTx        |     boolean      | Is it a system transaction     |  yes   |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlockTx        |     boolean      | Is it an unlocked transaction     |  yes   |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifySignature |     boolean      | Do transactions require signatures    |  yes   |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verifyFee       |     boolean      | Do transactions require verification fees |  yes   |
| delList                                                         | list&lt;integer> | Pending removal of registered transaction data  |  no   |

#### Return value
| Field Name   |  Field type   | Parameter Description   |
| ----- |:-------:| ------ |
| value | boolean | Is registration successful |

### tx\_getTx
according tohashObtain transactions, First check for unconfirmed information, Can't find it, check again. Confirmed/Get transaction by tx hash
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name     |  Parameter type  | Parameter Description      | Is it not empty |
| ------- |:------:| --------- |:----:|
| chainId |  int   | chainid       |  yes   |
| txHash  | string | Transaction to be queriedhash |  yes   |

#### Return value
| Field Name |  Field type  | Parameter Description             |
| --- |:------:| ---------------- |
| tx  | string | The string of serialized data obtained from the transaction |

### tx\_newTx
Receive local new transactions/receive a new transaction
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name     |  Parameter type  | Parameter Description       | Is it not empty |
| ------- |:------:| ---------- |:----:|
| chainId |  int   | chainid        |  yes   |
| tx      | string | Transaction serialization data string |  yes   |

#### Return value
| Field Name   |  Field type   | Parameter Description   |
| ----- |:-------:| ------ |
| value | boolean | Whether successful   |
| hash  | string  | transactionhash |

### tx\_batchVerify
Verify all transactions in the block/Verify all transactions in the block
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name          |      Parameter type       | Parameter Description            | Is it not empty |
| ------------ |:---------------:| --------------- |:----:|
| chainId      |       int       | chainid             |  yes   |
| txList       | list&lt;string> | Collection of serialized data strings for transactions to be verified |  yes   |
| blockHeader  |     string      | Corresponding block header          |  yes   |
| preStateRoot |     string      | Previous block state root        |  yes   |

#### Return value
| Field Name          |      Field type       | Parameter Description       |
| ------------ |:---------------:| ---------- |
| value        |     boolean     | Verified successfully     |
| contractList | list&lt;string> | New transactions generated by smart contracts |

### tx\_rollback
Rollback block transactions/transaction rollback
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name         |      Parameter type       | Parameter Description    | Is it not empty |
| ----------- |:---------------:| ------- |:----:|
| chainId     |       int       | chainid     |  yes   |
| txHashList  | list&lt;string> | Collection of transactions to be rolled back |  yes   |
| blockHeader |     string      | Block head     |  yes   |

#### Return value
| Field Name   |  Field type   | Parameter Description |
| ----- |:-------:| ---- |
| value | boolean | Whether successful |

### tx\_cs\_state
Set node packaging status(Set by consensus module)/Set the node packaging state
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name       |  Parameter type   | Parameter Description   | Is it not empty |
| --------- |:-------:| ------ |:----:|
| chainId   |   int   | chainid    |  yes   |
| packaging | boolean | Is packaging in progress |  yes   |

#### Return value
| Field Name | Field type | Parameter Description             |
| --- |:----:| ---------------- |
| N/A | void | No specific return value, set successfully without errors |

### tx\_packableTxs
Obtain a packable transaction set/returns a list of packaged transactions
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name            |  Parameter type  | Parameter Description      | Is it not empty |
| -------------- |:------:| --------- |:----:|
| chainId        |  int   | chainid       |  yes   |
| endTimestamp   |  long  | Deadline      |  yes   |
| maxTxDataSize  |  int   | Maximum capacity of transaction set   |  yes   |
| blockTime      |  long  | Time of block production this time  |  yes   |
| packingAddress | string | Current block address    |  yes   |
| preStateRoot   | string | The state root of the previous block |  yes   |

#### Return value
| Field Name           |      Field type       | Parameter Description      |
| ------------- |:---------------:| --------- |
| list          | list&lt;string> | Packable transaction set    |
| stateRoot     |     string      | The current state root of the block  |
| packageHeight |      long       | The height of the packaged blocks this time |

### tx\_backPackableTxs
The consensus module returns transactions that cannot be packaged and adds them back to the list to be packaged/back packaged transactions
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name     |      Parameter type       | Parameter Description         | Is it not empty |
| ------- |:---------------:| ------------ |:----:|
| chainId |       int       | chainid          |  yes   |
| txList  | list&lt;string> | Transaction serialization data string collection |  yes   |

#### Return value
| Field Name   |  Field type   | Parameter Description |
| ----- |:-------:| ---- |
| value | boolean | Whether successful |

### tx\_save
Save transactions for new blocks/Save the confirmed transaction
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name          |      Parameter type       | Parameter Description     | Is it not empty |
| ------------ |:---------------:| -------- |:----:|
| chainId      |       int       | chainid      |  yes   |
| txList       | list&lt;string> | Transaction set to be saved |  yes   |
| contractList | list&lt;string> | Smart contract trading   |  yes   |
| blockHeader  |     string      | Block head      |  yes   |

#### Return value
| Field Name   |  Field type   | Parameter Description |
| ----- |:-------:| ---- |
| value | boolean | Whether successful |

### tx\_gengsisSave
Save transactions for Genesis blocks/Save the transactions of the Genesis block 
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name         |      Parameter type       | Parameter Description     | Is it not empty |
| ----------- |:---------------:| -------- |:----:|
| chainId     |       int       | chainid      |  yes   |
| txList      | list&lt;string> | Transaction set to be saved |  yes   |
| blockHeader |     string      | Block head      |  yes   |

#### Return value
| Field Name   |  Field type   | Parameter Description |
| ----- |:-------:| ---- |
| value | boolean | Whether successful |

### tx\_getSystemTypes
Get all system transaction types/Get system transaction types
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name     | Parameter type | Parameter Description | Is it not empty |
| ------- |:----:| ---- |:----:|
| chainId | int  | chainid  |  yes   |

#### Return value
| Field Name  |       Field type       | Parameter Description     |
| ---- |:----------------:| -------- |
| list | list&lt;integer> | System transaction type collection |

### tx\_getConfirmedTx
according tohashObtain confirmed transactions(Only check confirmed)/Get confirmed transaction by tx hash
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name     |  Parameter type  | Parameter Description      | Is it not empty |
| ------- |:------:| --------- |:----:|
| chainId |  int   | chainid       |  yes   |
| txHash  | string | Transaction to be queriedhash |  yes   |

#### Return value
| Field Name |  Field type  | Parameter Description             |
| --- |:------:| ---------------- |
| tx  | string | The string of serialized data obtained from the transaction |

### tx\_getBlockTxs
Obtain the complete transaction of the block. If no query is found, or if the query does not include the complete transaction data of the block, return an empty set/Get block transactions
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name        |      Parameter type       | Parameter Description        | Is it not empty |
| ---------- |:---------------:| ----------- |:----:|
| chainId    |       int       | chainid         |  yes   |
| txHashList | list&lt;string> | Transaction to be queriedhashaggregate |  yes   |

#### Return value
| Field Name    |      Field type       | Parameter Description           |
| ------ |:---------------:| -------------- |
| txList | list&lt;string> | Returns a collection of transaction serialization data strings |

### tx\_getBlockTxsExtend
according tohashList, obtain transactions, check for unconfirmed first, then check for confirmed/Get transactions by hashs
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name        |      Parameter type       | Parameter Description                                       | Is it not empty |
| ---------- |:---------------:| ------------------------------------------ |:----:|
| chainId    |       int       | chainid                                        |  yes   |
| txHashList | list&lt;string> | Transaction to be queriedhashaggregate                                |  yes   |
| allHits    |     boolean     | true：All data must be found before returning, otherwise return emptylist； false：How many were found and how many were returned |  yes   |

#### Return value
| Field Name    |      Field type       | Parameter Description           |
| ------ |:---------------:| -------------- |
| txList | list&lt;string> | Returns a collection of transaction serialization data strings |

### tx\_getNonexistentUnconfirmedHashs
Query incoming transactionshashin,Transactions that are not in the unconfirmed databasehash/Get nonexistent unconfirmed transaction hashs
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name        |      Parameter type       | Parameter Description        | Is it not empty |
| ---------- |:---------------:| ----------- |:----:|
| chainId    |       int       | chainid         |  yes   |
| txHashList | list&lt;string> | Transaction to be queriedhashaggregate |  yes   |

#### Return value
| Field Name    |      Field type       | Parameter Description           |
| ------ |:---------------:| -------------- |
| txList | list&lt;string> | Returns a collection of transaction serialization data strings |

### tx\_bl\_state
Set node block synchronization status(Set by block module)/Set the node block state
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name     | Parameter type | Parameter Description          | Is it not empty |
| ------- |:----:| ------------- |:----:|
| chainId | int  | chainid           |  yes   |
| status  | int  | Is waiting entered, Do not process transactions |  yes   |

#### Return value
| Field Name | Field type | Parameter Description             |
| --- |:----:| ---------------- |
| N/A | void | No specific return value, set successfully without errors |

### tx\_blockHeight
Receive the latest block height/Receive the latest block height
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name     | Parameter type | Parameter Description | Is it not empty |
| ------- |:----:| ---- |:----:|
| chainId | int  | chainid  |  yes   |
| height  | long | block height |  yes   |

#### Return value
| Field Name   |  Field type   | Parameter Description |
| ----- |:-------:| ---- |
| value | boolean | Whether successful |

### tx\_getTxClient
according tohashObtain the transaction, first check for unconfirmed information, then check for confirmed information if not found/Get transaction by tx hash
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name     |  Parameter type  | Parameter Description      | Is it not empty |
| ------- |:------:| --------- |:----:|
| chainId |  int   | chainid       |  yes   |
| txHash  | string | Transaction to be queriedhash |  yes   |

#### Return value
| Field Name    |  Field type  | Parameter Description                   |
| ------ |:------:| ---------------------- |
| tx     | string | The string of serialized data obtained from the transaction       |
| height | string | The confirmation height of the transaction obtained, while the unconfirmed transaction height is-1 |
| status | string | The status of whether the obtained transaction is confirmed or not          |

### tx\_verifyTx
Verify transaction interfaces, including basic verification、Validator、Ledger verification/Verify transation
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name     |  Parameter type  | Parameter Description       | Is it not empty |
| ------- |:------:| ---------- |:----:|
| chainId |  int   | chainid        |  yes   |
| tx      | string | Complete transaction string to be verified |  yes   |

#### Return value
| Field Name   |  Field type  | Parameter Description   |
| ----- |:------:| ------ |
| value | string | transactionhash |

### transferCMDTest

#### scope:public
#### version:1.0

#### parameter list
No parameters

#### Return value
No return value

### tx\_getConfirmedTxClient
according tohashObtain confirmed transactions(Only check confirmed)/Get confirmed transaction by tx hash
#### scope:public
#### version:1.0

#### parameter list
| Parameter Name     |  Parameter type  | Parameter Description      | Is it not empty |
| ------- |:------:| --------- |:----:|
| chainId |  int   | chainid       |  yes   |
| txHash  | string | Transaction to be queriedhash |  yes   |

#### Return value
| Field Name    |  Field type  | Parameter Description             |
| ------ |:------:| ---------------- |
| tx     | string | The string of serialized data obtained from the transaction |
| height | string | The confirmation height of the transaction obtained      |
| status | string | The status of whether the obtained transaction is confirmed or not    |

